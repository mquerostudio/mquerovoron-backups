#####################################################################
#   Happy Hare includes
#####################################################################
[include mmu/base/*.cfg]
[include mmu/optional/client_macros.cfg]

#####################################################################
#   File locations and on error handling
#####################################################################
[virtual_sdcard]
path: /home/mquero/printer_data/gcodes
on_error_gcode: CANCEL_PRINT

#####################################################################
#   Device ID's
#####################################################################
[mcu]
canbus_uuid: c3aada489a35     

[mcu EBBCan]
canbus_uuid: 36b15bed4b26

#####################################################################
#   Basic Klipper and Printer setup
#####################################################################
[printer]
kinematics: corexy
max_velocity: 500
max_accel: 20000
max_z_velocity: 35
max_z_accel: 300
square_corner_velocity: 5
minimum_cruise_ratio: 0.0

[exclude_object]
[print_stats]
[skew_correction]

[gcode_arcs]
resolution: 0.05

[idle_timeout]
timeout: 3600

[force_move]
enable_force_move: True

#####################################################################
#   Includes
#####################################################################
## Configuration files
[include mainsail.cfg]
[include config/stealthburner_leds.cfg]
[include config/extruder.cfg]
[include config/steppers.cfg]
[include config/temperature_sensors.cfg]
[include config/homing.cfg]
[include config/fans.cfg]
[include config/disco.cfg]
[include config/input_shaper.cfg]

## Macros
[include macros/movement_macros.cfg]
[include macros/printing_macros.cfg]
[include macros/print_start_end.cfg]

## Cartographer macro
[include macros/cartographer_macros.cfg]

## MMU Macros
[include mmu/optional/client_macros.cfg]
[include mmu/addons/blobifier.cfg]
[include macros/custom_blobifier.cfg]
[include macros/custom_mmu_macros.cfg]

#####################################################################
#   Stepper current delayed gcode and notification infrastructure
#####################################################################
[gcode_macro MR_NOTIFY]
description: Allows you to send a custom notification via Mobileraker without using the M117 command
gcode:
    {% set msg = "MR_NOTIFY:" ~ (params.TITLE ~ "|" if 'TITLE' in params|upper else "") ~ params.MESSAGE %}

    {% if 'MESSAGE' in params|upper %}
        { action_respond_info(msg) }
    {% else %}
        { action_raise_error('Must provide MESSAGE parameter') }
    {% endif %}

[delayed_gcode SET_STEPPER_CURRENT] 
initial_duration: 2
gcode:
  _SET_PRINT_CURRENT
  M400
  update_git
  M400
  REFRESH_SPOOLMAN
  M84

[gcode_macro update_git]
gcode:
    {% set message = params.MESSAGE|default() %}
    {% if message %}
        RUN_SHELL_COMMAND CMD=update_git_script_message PARAMS="'{params.MESSAGE}'"
    {% else %}
        RUN_SHELL_COMMAND CMD=update_git_script
    {% endif %}

[gcode_shell_command update_git_script]
command: bash -c "bash $HOME/klipper-backup/script.sh"
timeout: 90.0
verbose: True

[gcode_shell_command update_git_script_message]
command: bash -c "bash $HOME/klipper-backup/script.sh $0"
timeout: 90.0
verbose: True

## Timelapse
[include timelapse.cfg]



#####################################################################
##	                       MACROS                                  ##
#####################################################################


#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [scanner]
#*# mode = touch
#*# scanner_touch_threshold = 2500
#*# scanner_touch_speed = 3
#*#
#*# [scanner model default]
#*# model_coef = 1.347979336249311,
#*# 	1.7731524180353069,
#*# 	0.7295471486831152,
#*# 	0.27497663482752405,
#*# 	0.5527224607650989,
#*# 	0.7740177342969196,
#*# 	-0.5348154172372557,
#*# 	-0.8968363372871337,
#*# 	0.45340647049338245,
#*# 	0.5250055017082331
#*# model_domain = 3.1770468291231747e-07,3.334523441906454e-07
#*# model_range = 0.100000,5.000000
#*# model_temp = 37.362860
#*# model_offset = 0.00000
#*# model_mode = touch
#*# model_fw_version = CARTOGRAPHER 5.1.0
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  0.143672, 0.136033, 0.133870, 0.122508, 0.133414, 0.117061, 0.127747, 0.111481, 0.122329, 0.103009, 0.115678, 0.105823, 0.114323, 0.108787, 0.118873, 0.112003, 0.124297, 0.119793, 0.124848, 0.110247, 0.109597, 0.116494, 0.122520, 0.126836, 0.129743, 0.138438, 0.132920, 0.150256, 0.144534, 0.156408
#*# 	  0.130839, 0.123293, 0.116305, 0.111199, 0.110420, 0.113083, 0.106421, 0.112353, 0.098336, 0.103678, 0.092699, 0.098180, 0.087283, 0.096359, 0.084664, 0.101485, 0.092111, 0.110970, 0.092293, 0.102610, 0.086235, 0.101293, 0.100836, 0.112130, 0.109730, 0.125194, 0.122603, 0.137643, 0.135125, 0.146073
#*# 	  0.116278, 0.114213, 0.102264, 0.097917, 0.095524, 0.094341, 0.092306, 0.084576, 0.085585, 0.077729, 0.077800, 0.067627, 0.072401, 0.067200, 0.077676, 0.071861, 0.094331, 0.082356, 0.093863, 0.072420, 0.088801, 0.078241, 0.102966, 0.099500, 0.113736, 0.112460, 0.128679, 0.126476, 0.143836, 0.138545
#*# 	  0.104816, 0.102850, 0.082818, 0.091331, 0.076202, 0.090005, 0.077710, 0.088087, 0.070110, 0.073360, 0.060830, 0.063955, 0.054492, 0.063928, 0.060653, 0.070279, 0.069493, 0.080941, 0.077178, 0.070052, 0.068770, 0.076344, 0.090231, 0.088756, 0.100493, 0.102279, 0.117393, 0.117096, 0.132380, 0.130002
#*# 	  0.091113, 0.090517, 0.074508, 0.078998, 0.075035, 0.080530, 0.075006, 0.076464, 0.067695, 0.070705, 0.059192, 0.059851, 0.051462, 0.060307, 0.057529, 0.060025, 0.066750, 0.071242, 0.069222, 0.055116, 0.059790, 0.058232, 0.074786, 0.071676, 0.085241, 0.086458, 0.103282, 0.101949, 0.127186, 0.114167
#*# 	  0.077504, 0.075237, 0.060778, 0.062449, 0.059881, 0.065295, 0.061963, 0.064623, 0.062573, 0.058376, 0.057476, 0.046302, 0.050182, 0.046022, 0.056160, 0.053376, 0.064351, 0.064194, 0.069421, 0.055399, 0.059881, 0.053494, 0.072143, 0.065299, 0.082250, 0.082740, 0.103226, 0.099120, 0.113068, 0.109407
#*# 	  0.072454, 0.066227, 0.056329, 0.053729, 0.052348, 0.059000, 0.052783, 0.060789, 0.052116, 0.058039, 0.041273, 0.045037, 0.030680, 0.044764, 0.036157, 0.052912, 0.053529, 0.064595, 0.055034, 0.053691, 0.047252, 0.060756, 0.059782, 0.071502, 0.070870, 0.089215, 0.090133, 0.098751, 0.106613, 0.110236
#*# 	  0.072984, 0.059708, 0.057311, 0.046024, 0.057469, 0.055921, 0.064003, 0.059178, 0.059921, 0.042678, 0.045728, 0.027144, 0.036707, 0.029225, 0.037374, 0.034924, 0.047978, 0.047266, 0.049639, 0.035446, 0.040690, 0.042191, 0.053762, 0.052978, 0.065150, 0.076059, 0.084684, 0.093527, 0.101869, 0.111547
#*# 	  0.061581, 0.051100, 0.044290, 0.039087, 0.050117, 0.048565, 0.060194, 0.055479, 0.048083, 0.040618, 0.032150, 0.024946, 0.017977, 0.026498, 0.024781, 0.033259, 0.034656, 0.045866, 0.038400, 0.034150, 0.027123, 0.038819, 0.038598, 0.056396, 0.051061, 0.075303, 0.072160, 0.094198, 0.096777, 0.108286
#*# 	  0.055542, 0.037943, 0.034527, 0.028975, 0.038807, 0.037267, 0.047862, 0.039751, 0.037723, 0.026052, 0.022729, 0.010658, 0.014696, 0.017698, 0.021686, 0.025769, 0.032488, 0.043139, 0.035798, 0.033934, 0.023852, 0.033806, 0.036221, 0.047098, 0.048790, 0.063401, 0.069408, 0.082243, 0.086352, 0.100745
#*# 	  0.040537, 0.029813, 0.026894, 0.019719, 0.034391, 0.027442, 0.039348, 0.028569, 0.027203, 0.019851, 0.016402, 0.007184, 0.010817, 0.009352, 0.018525, 0.019862, 0.032794, 0.032006, 0.032549, 0.019442, 0.016038, 0.020594, 0.027451, 0.033071, 0.039357, 0.050653, 0.053359, 0.069793, 0.074172, 0.087965
#*# 	  0.035232, 0.026294, 0.019761, 0.016694, 0.021781, 0.026384, 0.026940, 0.028770, 0.016018, 0.014629, 0.000853, 0.004838, -0.001321, 0.008384, 0.006507, 0.019324, 0.018668, 0.032476, 0.018846, 0.020410, 0.004467, 0.015254, 0.016536, 0.027335, 0.030806, 0.045106, 0.049636, 0.064624, 0.072141, 0.081607
#*# 	  0.029955, 0.021743, 0.014795, 0.010754, 0.015403, 0.015041, 0.019988, 0.013728, 0.011410, 0.001721, -0.002061, -0.010181, -0.007249, -0.005658, 0.006703, 0.006568, 0.025044, 0.020037, 0.024487, 0.007291, 0.010866, 0.004713, 0.023583, 0.023101, 0.035017, 0.041385, 0.057128, 0.061576, 0.076662, 0.076986
#*# 	  0.026702, 0.022718, 0.011120, 0.012115, 0.004420, 0.013827, 0.009121, 0.016297, 0.003387, 0.002493, -0.008616, -0.009264, -0.013172, -0.004092, -0.000684, 0.007463, 0.010134, 0.019675, 0.012604, 0.005629, 0.001902, 0.006711, 0.013424, 0.019635, 0.028043, 0.037871, 0.050985, 0.058332, 0.072743, 0.074361
#*# 	  0.026065, 0.018983, 0.008186, 0.009291, 0.005271, 0.012266, 0.010258, 0.012864, 0.006030, 0.005763, -0.004761, -0.005869, -0.009515, -0.004787, 0.000386, 0.003029, 0.010067, 0.010721, 0.012653, -0.000846, -0.001926, -0.000728, 0.010438, 0.010258, 0.021676, 0.029519, 0.045164, 0.051053, 0.070599, 0.066603
#*# 	  0.020525, 0.016063, 0.003170, 0.003422, -0.001080, 0.005397, 0.004483, 0.008585, 0.007211, 0.004020, -0.002859, -0.007838, -0.004583, -0.004826, 0.001382, 0.001094, 0.010653, 0.014899, 0.016234, 0.001113, -0.000325, 0.001026, 0.010601, 0.009491, 0.021723, 0.031140, 0.046540, 0.052919, 0.065104, 0.068422
#*# 	  0.027732, 0.017900, 0.008490, 0.003794, 0.001945, 0.007744, 0.007881, 0.010842, 0.006726, 0.009888, -0.002310, -0.002067, -0.009183, -0.000503, -0.001667, 0.004474, 0.008522, 0.019327, 0.011652, 0.001864, -0.004521, 0.004570, 0.007429, 0.016844, 0.020440, 0.033425, 0.045553, 0.055547, 0.064492, 0.065800
#*# 	  0.034897, 0.018194, 0.013602, 0.006431, 0.010782, 0.010811, 0.017560, 0.014165, 0.017263, 0.010828, 0.007077, -0.006698, -0.001169, -0.006412, 0.002329, -0.000362, 0.009518, 0.011791, 0.011463, -0.003678, -0.004128, -0.002569, 0.007605, 0.010866, 0.020679, 0.034856, 0.045930, 0.057062, 0.065563, 0.070403
#*# 	  0.034638, 0.021643, 0.014010, 0.009951, 0.013515, 0.015027, 0.018043, 0.018231, 0.016328, 0.013563, 0.005298, -0.000697, -0.005032, -0.001170, -0.001318, 0.003675, 0.007553, 0.015294, 0.011035, 0.000588, -0.006627, 0.003248, 0.003091, 0.015734, 0.016265, 0.037973, 0.046108, 0.060270, 0.065179, 0.073902
#*# 	  0.044052, 0.022782, 0.022963, 0.011527, 0.015921, 0.016412, 0.021697, 0.018000, 0.020738, 0.012926, 0.008378, -0.002014, 0.001181, 0.002768, 0.005237, 0.007502, 0.014522, 0.018251, 0.013774, 0.005668, -0.003267, 0.003487, 0.006474, 0.015028, 0.019846, 0.035535, 0.045375, 0.056770, 0.064618, 0.072209
#*# 	  0.045424, 0.034278, 0.027459, 0.020451, 0.025095, 0.022662, 0.027819, 0.027154, 0.027732, 0.022376, 0.013606, 0.008000, 0.008023, 0.007662, 0.012569, 0.012663, 0.021250, 0.022832, 0.017479, 0.005335, -0.000415, 0.002920, 0.008630, 0.014236, 0.017074, 0.034251, 0.044008, 0.057054, 0.063645, 0.070881
#*# 	  0.052019, 0.041796, 0.035035, 0.029305, 0.028821, 0.029362, 0.031242, 0.035044, 0.030261, 0.031375, 0.018806, 0.016503, 0.010982, 0.015578, 0.016138, 0.020078, 0.023703, 0.029175, 0.017560, 0.013836, 0.000200, 0.006067, 0.009145, 0.016179, 0.022728, 0.036751, 0.045821, 0.059174, 0.067158, 0.072973
#*# 	  0.058074, 0.048390, 0.042285, 0.035616, 0.035781, 0.034055, 0.036207, 0.035556, 0.035096, 0.031883, 0.024018, 0.017940, 0.016611, 0.016354, 0.021764, 0.020677, 0.030669, 0.028941, 0.025227, 0.012814, 0.008260, 0.009553, 0.015465, 0.018674, 0.027094, 0.037643, 0.051562, 0.060939, 0.072552, 0.075628
#*# 	  0.067762, 0.060220, 0.049009, 0.046001, 0.039616, 0.044993, 0.039801, 0.045976, 0.038885, 0.039310, 0.028509, 0.025872, 0.022064, 0.026893, 0.027110, 0.030587, 0.033458, 0.036989, 0.028513, 0.018449, 0.011870, 0.014246, 0.018620, 0.023741, 0.030407, 0.043237, 0.053790, 0.064040, 0.075881, 0.081457
#*# 	  0.077301, 0.067901, 0.059700, 0.055484, 0.053895, 0.054026, 0.052876, 0.052993, 0.050853, 0.049637, 0.041049, 0.035647, 0.034288, 0.036943, 0.039356, 0.039146, 0.043433, 0.044440, 0.038942, 0.026001, 0.019296, 0.019338, 0.025050, 0.029007, 0.036306, 0.048214, 0.060752, 0.068835, 0.083622, 0.087150
#*# 	  0.086743, 0.080310, 0.069229, 0.067975, 0.064077, 0.066593, 0.065458, 0.065010, 0.063309, 0.061131, 0.054257, 0.049626, 0.050845, 0.049173, 0.054104, 0.051421, 0.055756, 0.056243, 0.052736, 0.036698, 0.031391, 0.030756, 0.036104, 0.038131, 0.044372, 0.057951, 0.069427, 0.080057, 0.090896, 0.098981
#*# 	  0.104998, 0.095238, 0.089318, 0.083840, 0.083781, 0.084304, 0.083384, 0.082851, 0.080817, 0.078248, 0.071246, 0.066676, 0.063805, 0.065377, 0.066034, 0.065678, 0.068479, 0.069303, 0.062453, 0.049924, 0.042220, 0.044585, 0.045888, 0.051674, 0.055064, 0.067600, 0.079104, 0.089696, 0.100970, 0.109767
#*# 	  0.123515, 0.110669, 0.107940, 0.100485, 0.103700, 0.103081, 0.105433, 0.102225, 0.102948, 0.097945, 0.092825, 0.081429, 0.083338, 0.080468, 0.082398, 0.080120, 0.083525, 0.081506, 0.077017, 0.063079, 0.058223, 0.056718, 0.061011, 0.060930, 0.066153, 0.077376, 0.088079, 0.100611, 0.110771, 0.120484
#*# 	  0.136237, 0.128754, 0.122035, 0.119139, 0.120368, 0.123704, 0.124768, 0.123308, 0.121020, 0.117035, 0.108763, 0.103431, 0.100013, 0.100942, 0.100945, 0.098242, 0.099770, 0.100705, 0.094943, 0.083159, 0.076186, 0.077385, 0.078404, 0.078816, 0.079072, 0.091783, 0.102306, 0.113084, 0.124291, 0.134696
#*# 	  0.158040, 0.147677, 0.147785, 0.141008, 0.144455, 0.146288, 0.148409, 0.147190, 0.150626, 0.145051, 0.138527, 0.127377, 0.124980, 0.122419, 0.122417, 0.119301, 0.119598, 0.120212, 0.114606, 0.104431, 0.096168, 0.096719, 0.098763, 0.100491, 0.102108, 0.112585, 0.121346, 0.128664, 0.138512, 0.149296
#*# x_count = 30
#*# y_count = 30
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 40.0
#*# max_x = 310.0
#*# min_y = 40.0
#*# max_y = 305.0
